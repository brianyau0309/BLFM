#!/bin/sh

div='|'

printNotification() {
  [ -f /tmp/.dunsttoggle ] && echo ğŸ”• || echo ğŸ””
}

printStorage() {
  df -h ~ | grep -v 'Filesystem' | awk '{ print "ïŸ‰ " $4 }'
}

printDate() {
  date '+ğŸ—“ %b-%d %a %H:%M:%S'
}

printAudio() {
  # alsa
  #volumenum=$(echo $(amixer sget Master | grep 'Mono:' | awk -F"[][]" '{ print $2 }') | sed 's/%//')
  #amixer sget Master | grep off >/dev/null &&
    #echo ğŸ”‡ ||
    #( ([ $volumenum -gt 80 ] && echo ğŸ”Š) ||
      #([ $volumenum -gt 20 ] && echo ğŸ”‰) ||
      #echo ğŸ”ˆ )

  # pulseaudio
  volumenum=$(pulsemixer --get-volume | cut -d' ' -f1)
  [ $(pulsemixer --get-mute) -eq 1 ] &&
    echo ğŸ”‡ ||
    ( ([ $volumenum -gt 80 ] && echo ğŸ”Š) ||
      ([ $volumenum -gt 20 ] && echo ğŸ”‰) ||
      echo ğŸ”ˆ )
}

printMusic() {
  pgrep mocp >/dev/null && [ ! "$(mocp -M $HOME/.config/moc -Q %file 2>/dev/null)" = ""  ] &&
    ((mocp -M $HOME/.config/moc -i 2>/dev/null | grep PLAY >/dev/null) && echo "ï€" || echo "ïŠ‹") &&
    mocp -M $HOME/.config/moc -Q %song 2>/dev/null
}

printBattery() {
  bat=$(cat /sys/class/power_supply/BAT0/capacity)
  bat_status=$(cat /sys/class/power_supply/BAT0/status)
  [ "$bat_status" = "Charging" ] && echo ï–ƒ ||
    ( ([ $bat -gt 90 ] && echo ï•¸) ||
      ([ $bat -gt 80 ] && echo ï–) ||
      ([ $bat -gt 70 ] && echo ï–€) ||
      ([ $bat -gt 60 ] && echo ï•¿) ||
      ([ $bat -gt 50 ] && echo ï•¾) ||
      ([ $bat -gt 40 ] && echo ï•½) ||
      ([ $bat -gt 30 ] && echo ï•¼) ||
      ([ $bat -gt 20 ] && echo ï•») ||
      ([ $bat -gt 10 ] && echo ï•º) ||
      echo ï•¹ )
  echo "$bat%"
}

printInternet() {
  ethernet=$(cat /sys/class/net/eno1/operstate)
  wifi=$(cat /sys/class/net/wlp1s0//operstate)
  [ "$ethernet" = "up" ] && echo ï›¿  ||
    ([ "$wifi" = "up" ] && echo ï‡«  || echo ïª©)
}

printBluetooth() {
  btpower=$(bluetoothctl show | grep Powered: | cut -d' ' -f2)
  [ $btpower = "yes" ] &&
  echo ïŠ“
}

statusBar() {
  printMusic
  [ -z $(wkon anchor)  ] || echo "ğŸ“ $(wkon anchor | rev | cut -d'/' -f1 | rev)"
  printStorage
  printBattery
  printDate
  printAudio
  printNotification
  printBluetooth
  printInternet
}

# Reset while enter xorg
[ -f /tmp/.dunsttoggle ] && rm /tmp/.dunsttoggle

while :; do
  xsetroot -name " $( statusBar | tr '\n' ' ')" #Change newline to space
  sleep 15
done
